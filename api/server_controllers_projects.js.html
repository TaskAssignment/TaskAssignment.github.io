<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server/controllers/projects.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server/controllers/projects.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/** Module to handle saving and fetching projects (and thing related to them,
* like issues or contributors).
*
* @module projects
* @requires mongoose
**/

var mongoose = require('mongoose');
var Project  = mongoose.model('Project');

module.exports = function (BaseFrame){
    return {

        /** Saves a project if it doens't exist in the database yet. Otherwise
        * just retrives the project that matches the params.
        *
        * @param {Object} req - Express request.
        * @param {Object} res - Express response.
        * @param {Object} req.query - Object with projectId to filter Projects.
        * @return {Object} Send the project created (or found).
        **/
        save: function(req, res){
            Project.findOne(req.query, function (err, result){
                if(result){
                    res.send(result);
                }else{
                    var project = req.query;

                    Project.create(project, function(err, project){
                        if(err){
                            res.send(err);
                        }
                        res.send(project);
                    });
                }
            });
        },

        /** Look for a project in the databse with the given contraints
        *
        * @param {Object} req - Express request.
        * @param {Object} res - Express response.
        * @param {Object} req.params - Object with projectId to filter Projects.
        * @return {Object} Send the project found.
        **/
        get: function(req, res){
            Project.findOne(req.params, 'name').lean().exec(function (err, project) {
                res.send(project);
            });
        },

        /** Look for projects in the databse with the given contraints. It is different
        * from get because it can return zero or more projects.
        *
        * @param {Object} req - Express request.
        * @param {Object} res - Express response.
        * @param {Object} req.query - Constrainsts to filter Projects.
        * @return {Object} Send the all projects found with theese contraints.
        **/
        find: function (req, res) {
            Project.find(req.query, '_id name', {lean: true}, function (err, projects){
                res.send({projects: projects});
            })
        },

        /** Look for the issues of the given repository in the database
        *
        * @param {Object} req - Express request.
        * @param {Object} res - Express response.
        * @param {Number} req.params.projectId - The projectId to filter issues.
        * @return {Array} Send the GitHubIssues found for this project. For performance
            issues, it restricts the results to the newest 500 issues.
        * @todo Add pagination!
        **/
        findIssues: function (req, res){
            var GitHubIssue = mongoose.model('GitHubIssue');

            var filter = {
                project: req.params.projectId,
                isPR: false,
            };
            var items = '_id bug';

            GitHubIssue.find(filter, items).populate('bug', 'title')
              .sort('-number').limit(500).lean().exec(function(err, bugs){
                res.send(bugs);
            });
        }
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-admin.html">admin</a></li><li><a href="module-populator.html">populator</a></li><li><a href="module-projects.html">projects</a></li><li><a href="module-routes.html">routes</a></li><li><a href="module-table.html">table</a></li></ul><h3>Classes</h3><ul><li><a href="Bug.html">Bug</a></li><li><a href="BugzillaBug.html">BugzillaBug</a></li><li><a href="BugzillaProfile.html">BugzillaProfile</a></li><li><a href="Comment.html">Comment</a></li><li><a href="Commit.html">Commit</a></li><li><a href="CoOccurrence.html">CoOccurrence</a></li><li><a href="Developer.html">Developer</a></li><li><a href="Event.html">Event</a></li><li><a href="GenerateFileLog.html">GenerateFileLog</a></li><li><a href="GitHubIssue.html">GitHubIssue</a></li><li><a href="GitHubProfile.html">GitHubProfile</a></li><li><a href="Project.html">Project</a></li><li><a href="StackOverflowProfile.html">StackOverflowProfile</a></li><li><a href="StopWord.html">StopWord</a></li><li><a href="Tag.html">Tag</a></li></ul><h3>Global</h3><ul><li><a href="global.html#showLoadingScreen">showLoadingScreen</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jul 20 2016 15:02:19 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
